prg/tool/ctb

Contents:
log

log:
2022.8.6
00f060  00 00 00 00 00 00 00 00 00 00 00 00 c0 43 e0 87    .............C..
00f070  be 7e cd 01 fe ff ff ff 00 00 00 00 00 00 00 00    .~..............
every 100ns count from 1601/1/1
c0 43 e0 87 be 7e cd 01
末尾から 0x194 戻るのではなく UTF-16LE な "Root Entry" から 
0x6c 先にある 8 bytes。
00f000  52 00 6f 00 6f 00 74 00 20 00 45 00 6e 00 74 00    R.o.o.t. .E.n.t.
00f010  72 00 79 00 00 00 00 00 01 00 00 00 ff ff ff ff    r.y.............
00f020  01 00 00 00 c7 df 62 00 00 00 00 00 01 00 00 00    ......b.........
00f030  ff ff ff ff 01 00 00 00 81 00 62 00 00 00 00 00    ..........b.....
00f040  16 00 05 01 ff ff ff ff ff ff ff ff 02 00 00 00    ................
00f050  20 08 02 00 00 00 00 00 c0 00 00 00 00 00 00 46     ..............F
                                            v-- ここから
00f060  00 00 00 00 00 00 00 00 00 00 00 00 c0 43 e0 87    .............C..
00f070  be 7e cd 01 fe ff ff ff 00 00 00 00 00 00 00 00    .~..............
                 ^-- ここまで
00f080  57 00 6f 00 72 00 6b 00 62 00 6f 00 6f 00 6b 00    W.o.r.k.b.o.o.k.
00f090  00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00    ................
".xls" でも version によって格納場所が違うみたいだ。
       total  Root   lastW
m0.xls 0xf200 0xf000 0xf06c 2012/08/20 10:28:25 0x1cd7ebe87e043c0
m1.xls 0xd600 0xd000 0xd06c 2015/10/16 02:31:35 0x1d107bac6ded9a0
m2.xls 0xea00 0x0400 0x046c 2022/06/30 04:13:55 0x1d88c37d0a7fdf0
m3.xls 0x9000 0x8e00 0x8e6c                     0x000000000000000
m4.xls 0x7e00 0x0400 0x046c 2022/05/23 03:50:20 0x1d86e58392f2cc0
Root Entry block の場所がどこかに書かれていないものかな。
https://support.microsoft.com/en-us/office/file-formats-that-are-supported-in-excel-0943ff2c-6014-4e8d-aaea-b83d51d46247
.xls Excel 97 - Excel 2003 Workbook
.xls Microsoft Excel 5.0/95 Workbook
二種類だとすれば m0.xls m1.xls は 95 で m2.xls は 97 なのかな。
m0.xls
00ce90  49 45 00 00 1e 00 00 00 10 00 00 00 4d 69 63 72    IE..........Micr
00cea0  6f 73 6f 66 74 20 45 78 63 65 6c 00 40 00 00 00    osoft Excel.@...
00ceb0  00 ce cc 03 6c 81 c2 01 40 00 00 00 80 28 a8 66    ....l...@....(.f
00cec0  80 f5 c1 01 03 00 00 00 00 00 00 00 00 00 00 00    ................
m0.xls 0xf200 0xf000 0xf06c 2012/08/20 10:28:25
0x1c2816c03ccce00 2002/11/01 06:00:44
0x1c1f58066a82880 2002/05/07 04:33:56
m1.xls
00aea0  4d 69 63 72 6f 73 6f 66 74 20 45 78 63 65 6c 00    Microsoft Excel.
00aeb0  40 00 00 00 00 c4 8e da d2 5c ce 01 40 00 00 00    @........\..@...
00aec0  80 54 4a 1a 3a 1d cd 01 40 00 00 00 80 fd 0a ee    .TJ.:...@.......
m1.xls 0xd600 0xd000 0xd06c 2015/10/16 02:31:35
0x1ce5cd2da8ec400 2013/05/30 01:13:12
0x1cd1d3a1a4a5480 2012/04/18 08:06:05
m2.xls
00e590  40 00 00 00 80 c3 1b d0 37 8c d8 01 40 00 00 00    @.......7...@...
00e5a0  00 fd a5 13 66 8b d8 01 1f 00 00 00 10 00 00 00    ....f...........
00e5b0  4d 00 69 00 63 00 72 00 6f 00 73 00 6f 00 66 00    M.i.c.r.o.s.o.f.
00e5c0  74 00 20 00 45 00 78 00 63 00 65 00 6c 00 00 00    t. .E.x.c.e.l...
m2.xls 0xea00 0x0400 0x046c 2022/06/30 04:13:55
0x1d88c37d01bc380 2022/06/30 04:13:55
0x1d88b6613a5fd00 2022/06/29 03:12:34
m3.xls
006c90  1e 00 00 00 10 00 00 00 4d 69 63 72 6f 73 6f 66    ........Microsof
006ca0  74 20 45 78 63 65 6c 00 40 00 00 00 80 0b b8 bc    t Excel.@.......
006cb0  55 6b d8 01 40 00 00 00 80 62 51 5e 13 6c d8 01    Uk..@....bQ^.l..
m3.xls 0x9000 0x8e00 0x8e6c 0x0000000000000000
0x1d86b55bcb80b80 2022/05/19 07:54:58
0x1d86c135e516280 2022/05/20 06:32:24
m4.xls
0008d0  00 66 01 39 58 6e d8 01 40 00 00 00 00 66 01 39    .f.9Xn..@....f.9
0008e0  58 6e d8 01 03 00 00 00 00 00 00 00 00 00 00 00    Xn..............
m4.xls 0x7e00 0x0400 0x046c 2022/05/23 03:50:20 0x1d86e58392f2cc0
0x1d86e5839016600 2022/05/23 03:50:19
0x1d86e5839016600 2022/05/23 03:50:19
0x400 が Root Entry なら 0x46c から、そうでなければお尻から 0x??00 を
調べて Root Entry を探し、見つかったら 0x??6c から 8 bytes を得る。
./ctb xlsdt m0.xls
0xf000 : 2012/08/20 10:28:25 UTC

2022.7.23
win で作った 7z のファイル名が化けるのは cp932 を utf-16 として utf-8 に
変換してしまっているからだ。ctb で逆変換してみる。
既に list7z として実装済みだった。
7z l career.zip | ctb list7z | iconv -f cp932 -t utf-8
